# pre-commit auto-update workflow
# Dependabot does not support updating pre-commit so this workflow will do that
name: Pre-commit auto-update

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch: {}  # Allows manual executions

concurrency:
  group: pre-commit-autoupdate
  cancel-in-progress: true

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-update:
    runs-on: ubuntu-latest
    env:
      UV_INDEX_URL: https://pypi.org/simple
    steps:
      - uses: actions/checkout@v6

      - name: Read Python version
        id: python-version
        run: echo "version=$(cat .python-version)" >> "$GITHUB_OUTPUT"

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          python-version: ${{ steps.python-version.outputs.version }}
          enable-cache: true
          cache-dependency-glob: |
            **/uv.lock
            **/pyproject.toml

      - name: Install dev dependencies
        run: uv sync --only-group dev --no-install-project --frozen

      - name: Run pre-commit autoupdate
        run: uv run pre-commit autoupdate

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: update/pre-commit-autoupdate
          title: Auto-update pre-commit hooks
          commit-message: Auto-update pre-commit hooks
          body: Update versions of tools in pre-commit configs to latest version
          labels: dependencies
